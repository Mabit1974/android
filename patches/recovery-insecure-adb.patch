From 09407119d92e785e831db35b5f4e0289ce5f4543 Mon Sep 17 00:00:00 2001
From: milaq <micha.laqua@gmail.com>
Date: Tue, 21 Jul 2015 15:40:17 +0200
Subject: [PATCH] recovery: insecure adb

it's a recovery after all
---
 recovery.cpp | 28 +---------------------------
 1 file changed, 1 insertion(+), 27 deletions(-)

diff --git a/recovery.cpp b/recovery.cpp
index 09ac390..6e6662c 100644
--- a/recovery.cpp
+++ b/recovery.cpp
@@ -1149,33 +1149,7 @@ load_locale_from_cache() {
 
 static void
 setup_adbd() {
-    struct stat f;
-    const char *key_src = "/data/misc/adb/adb_keys";
-    const char *key_dest = "/adb_keys";
-
-    // Mount /data and copy adb_keys to root if it exists
-    ensure_path_mounted("/data");
-    if (stat(key_src, &f) == 0) {
-        FILE *file_src = fopen(key_src, "r");
-        if (file_src == NULL) {
-            LOGE("Can't open %s\n", key_src);
-        } else {
-            FILE *file_dest = fopen(key_dest, "w");
-            if (file_dest == NULL) {
-                LOGE("Can't open %s\n", key_dest);
-            } else {
-                char buf[4096];
-                while (fgets(buf, sizeof(buf), file_src)) fputs(buf, file_dest);
-                check_and_fclose(file_dest, key_dest);
-
-                // Enable secure adbd
-                property_set("ro.adb.secure", "1");
-            }
-            check_and_fclose(file_src, key_src);
-        }
-    }
-    ensure_path_unmounted("/data");
-
+    property_set("ro.adb.secure", "0");
     // Trigger (re)start of adb daemon
     property_set("service.adb.root", "1");
 }
-- 
2.4.5

